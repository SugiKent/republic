ruby:
  twitter_image_url = "https://placehold.jp/120/fefefe/328182/2400x1200.png?text=ã€#{@lesson.lesson_name}ã€%0A#{@lesson.professor_name}/#{@lesson.faculty.faculty_name}%0A%0A#{@lesson.lesson_detail.theme_subtitle if @lesson.lesson_detail.present?}&css=%7B%22text-align%22%3A%22%20left%22%2C%22padding-left%22%3A%22%2080px%22%2C%22line-height%22%3A%22%20180px%22%7D"
  description = "ã€#{@lesson.lesson_name}ã€ã®ã‚·ãƒ©ãƒã‚¹ã§ã™ã€‚è©³ç´°ãªã‚·ãƒ©ãƒã‚¹ã¨æˆæ¥­ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚#{@lesson.faculty.faculty_name}/#{@lesson.department.department_name}/#{@lesson.professor_name}/#{@lesson.lesson_detail.theme_subtitle if @lesson.lesson_detail.present?}"

  canonical_url = @lesson.same_lessons.split(',').last == @lesson.id.to_s ? nil : "https://www.rep-rikkyo.com/lesson/#{@lesson.same_lessons.split(',').last}"

  set_meta_tags title: "#{@lesson.lesson_name}ã®ã‚·ãƒ©ãƒã‚¹", description: description, canonical: canonical_url, og: {type: 'article', url: request.url}, twitter: {url: request.url, card: 'summary_large_image', image: twitter_image_url}

  # æ¤œç´¢çµæœãŒå­˜åœ¨ã™ã‚‹å ´åˆã€æœ€å¾Œã®çµæœã‚’ã€‚
  # ãªã„å ´åˆã¯ã‹ã‚‰æ–‡å­—ã‚’ã€‚
  searched_url = session[:search_history].present? ? session[:search_history] : ""
  # previous_urlã¨ä»Šã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‚‹URLãŒç•°ãªã‚Šã€
  # ã‹ã¤URLã«"seach"ã¨ã„ã†å˜èªãŒå«ã¾ã‚Œã¦ã„ã‚‹æ™‚ã«æ¤œç´¢çµæœã®ãƒ‘ãƒ³ããšã‚’å‡ºã™ã€‚
  if searched_url != request.fullpath && searched_url.include?("search")
    search = lesson_search_condition(searched_url)
    searched_link = searched_url
    breadcrumb :lesson_show, @lesson, search, searched_link
  else
    breadcrumb :lesson_show, @lesson
  end
- if flash.present?
  .row
    .col-md-12.col-xs-12
      - flash.each do |type, value|
        = content_tag(:div, "", class: "alert bg-info alert-#{type}")
          = value

- if @current_year_lesson.present? && @lesson.year != 2018
  p.alert.bg-danger.text-danger.mT10
    | ã“ã®æˆæ¥­ã¯éå»ã®æˆæ¥­ã§ã™ã€‚æœ€æ–°ã®æˆæ¥­ã¯ã€
    = link_to "ã“ã¡ã‚‰", @current_year_lesson.first, onClick: "gtag('event', 'click', {'event_category': 'lesson', 'event_label': 'to_current_year_lesson'});"
- elsif @lesson.year != 2018
  p.alert.bg-danger.text-danger.mT10
    | ã“ã®æˆæ¥­ã¯éå»ã®æˆæ¥­ã§ã™ã€‚2018å¹´åº¦ã«åŒåãƒ»åŒæ•™æˆã®é–‹è¬›ã¯ãªã„ã‚ˆã†ã§ã™ã€‚
.LessonDetail
  .LessonDetail__sns
    a.Sns__btn.Sns__btn--twitter href="http://twitter.com/share?url=#{request.url}&text=ã€#{@lesson.lesson_name}ã€ã®ã‚·ãƒ©ãƒã‚¹%0D%0A#{@lesson.professor_name}%0D%0A#{@lesson.faculty.faculty_name}/#{@lesson.department.department_name}%0D%0A" target="_blank" onClick="gtag('event', 'click', {'event_category': 'lesson', 'event_label': 'sns/twitter'});"
      | Twitter
    br
    a.Sns__btn.Sns__btn--line href="http://line.me/R/msg/text/?ã€#{@lesson.lesson_name}ã€ã®ã‚·ãƒ©ãƒã‚¹ã§ã™ã€‚è©³ç´°ãªã‚·ãƒ©ãƒã‚¹ã¨æˆæ¥­ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚%0A#{@lesson.faculty.faculty_name}/#{@lesson.department.department_name}%0A#{@lesson.professor_name}%0A#{@lesson.lesson_detail.theme_subtitle if @lesson.lesson_detail.present?}%0A#{request.url}" target="_blank" onClick="gtag('event', 'click', {'event_category': 'lesson', 'event_label': 'sns/line'});"
      | LINE
  = render 'lesson_header'
  = render 'syllabus'
  = render 'review'
  = render 'notify'
- unless amp_ready?
  .row
    .col-md-3.col-xs-12.mT10
      / @favosãŒã‚ã‚‹ãªã‚‰favorite_buttonã®åŸºæœ¬viewã‚’è¡¨ç¤º
      / @favosãŒç©ºãªã‚‰favorite_button_for_createã‚’è¡¨ç¤º
      div id="Favorite__button--#{@lesson.id}"
        - if @favos.present?
          = render 'classes/favorites/favorite_button', favos: @favos, lesson: @lesson, size: ""
        - else
          = render partial: "classes/favorites/favorite_button_for_create", locals: {lesson: @lesson, size: "md"}
    .col-md-8.col-xs-12.mT10
      a href="https://twitter.com/share?url=#{request.url}&text=ã€#{@lesson.lesson_name}ã€ ã‚’å±¥ä¿®ã—ãŸã“ã¨ã‚ã‚‹æ–¹ã„ã¾ã›ã‚“ã‹ï¼Ÿ ç«‹æ•™å¤§å­¦æˆæ¥­ãƒ¬ãƒ“ãƒ¥ãƒ¼å…±æœ‰ã‚µãƒ¼ãƒ“ã‚¹ã€Repï¼ˆ@rep_rikkyoï¼‰ã€" class="btn btn-info" target="_blank" onClick="gtag('event', 'click', {'event_category': 'lesson', 'event_label': 'twitter/from_footer'});"
        | ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ãŠé¡˜ã„ã™ã‚‹

    .col-xs-12
      hr
      h6
        | ãŠæ°—ã«å…¥ã‚Šã«ç™»éŒ²ã™ã‚‹ã¨ãƒ»ãƒ»ãƒ»
      h6.help-text
        | ãŠæ°—ã«å…¥ã‚Šã«ç™»éŒ²ã—ãŸæˆæ¥­ã¯ã€ãƒã‚¤ãƒšãƒ¼ã‚¸ã‹ã‚‰ç¢ºèªã§ãã¾ã™ã€‚
        br
        | ã¾ãŸã€
        = link_to "æ™‚é–“å‰²PDFä½œæˆ", pdfs_path, onClick: "gtag('event', 'click', {'event_category': 'lesson', 'event_label': 'to_pdf_path/from_footer_message'});"
        | ã‹ã‚‰ã€ãŠæ°—ã«å…¥ã‚Šæˆæ¥­ã®æ™‚é–“å‰²ã‚’ä½œæˆã§ãã¾ã™ï¼
        br
        | æ°—ã«ãªã£ãŸæˆæ¥­ã‚’ã©ã‚“ã©ã‚“ãŠæ°—ã«å…¥ã‚Šã«ç™»éŒ²ã—ã¦ã€å¾Œã‹ã‚‰è¦‹ç›´ã™ã¨ä¾¿åˆ©ã§ã™ï¼
      hr

- if @tagged_lessons.present?
  .Lesson__relative-lesson
    h4.text-success
      | æ©Ÿæ¢°å­¦ç¿’ã«ã‚ˆã‚‹ã‚ªã‚¹ã‚¹ãƒ¡æˆæ¥­
    = render 'lessonmodule_slider', lessons: @tagged_lessons, type: 'tagged_lesson'

- elsif @relative_lessons.present?
  .Lesson__relative-lesson
    h4.text-success
      | é–¢é€£æˆæ¥­
    = render 'lessonmodule_slider', lessons: @relative_lessons, type: 'relative_lesson'

- if @user_relative_lessons.present?
  .Lesson__relative-lesson
    h4.text-success
      | ã“ã®æˆæ¥­ã‚’å±¥ä¿®ã—ãŸäººã¯ã€ã“ã¡ã‚‰ã®æˆæ¥­ã‚‚å±¥ä¿®ã—ã¦ã„ã¾ã™
    = render 'lessonmodule_slider', lessons: @user_relative_lessons, type: 'user_relative_lesson'

- unless amp_ready?
  - if @lesson_history.present?
    .Lesson__relative-lesson
      h4.text-success
        | ã‚ãªãŸãŒé–²è¦§ã—ãŸã‚·ãƒ©ãƒã‚¹
      = render 'lessonmodule_slider', lessons: @lesson_history, type: 'lesson_history'

/ ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¿½åŠ ã—ãŸç›´å¾Œã§ã‚ã‚Œã°ã€ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤ºã™ã‚‹
- if flash[:success].present?
  #resultCreatedModal.modal.fade.mT30 role="dialog" tabindex="-1"
    .modal-dialog role="document"
      .modal-content
        .modal-header
          button.close aria-label="Close" data-dismiss="modal" type="button"
            span aria-hidden="true"  &times;
          h4.modal-title.text-info
            | ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼ğŸ‰
        .modal-body
          .row
            .col-xs-12.text-center.text-info
              p
                | ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®æ•°ãŒ
              h1
                = Result.count
              p
                | ã«ãªã‚Šã¾ã—ãŸï¼ğŸ˜†
              .mT15
                = image_tag 'illustration/cracker-bg.png', style: 'width:100%;'
        .modal-footer
          .row
            .col-xs-12.text-left.text-info
              h4
                | Repã‚’åºƒã‚ã¦ã€ã‚‚ã£ã¨ä¾¿åˆ©ã«ã€‚
              p
                | Repã¯ç«‹æ•™ç”Ÿã®æœ‰å¿—ãŒé–‹ç™ºã—ã¦ã„ã¾ã™ã€‚
                br
                | ã‚ãªãŸã®å¿œæ´ãŒåŠ›ã«ãªã‚Šã¾ã™ï¼
          textarea.form-control disabled='true' rows="4"
            = "Repç«‹æ•™å¤§å­¦ã‚·ãƒ©ãƒã‚¹æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ ã§ã€#{@lesson.lesson_name}ã€ ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ›¸ãã¾ã—ãŸï¼\n#{request.url}\n#Repç«‹æ•™"
          .text-center.mT15
            a.btn.btn-info href="https://twitter.com/share?url=#{request.url}&text=Repç«‹æ•™å¤§å­¦ã‚·ãƒ©ãƒã‚¹æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ ã§ã€#{@lesson.lesson_name}ã€ ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ›¸ãã¾ã—ãŸï¼&hashtags=Repç«‹æ•™" class="btn btn-info btn-sm" target="_blank" onClick="gtag('event', 'click', {'event_category': 'lesson', 'event_label': 'twitter/after_create_result/modal'});"
              | ã‚·ã‚§ã‚¢ã™ã‚‹
